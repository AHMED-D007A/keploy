(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2769:(e,t,a)=>{Promise.resolve().then(a.bind(a,9774))},9774:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>e4});var r=a(5155),s=a(2115),n=a(5695),l=a(9708),o=a(2085),i=a(2596),d=a(9688);function c(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,d.QP)((0,i.$)(t))}let u=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function h(e){let{className:t,variant:a,size:s,asChild:n=!1,...o}=e,i=n?l.DX:"button";return(0,r.jsx)(i,{"data-slot":"button",className:c(u({variant:a,size:s,className:t})),...o})}let g=s.createContext(null);function p(){let e=s.useContext(g);if(!e)throw Error("useSidebar must be used within a SidebarProvider");return e}function m(e){let{children:t}=e,[a,n]=s.useState(!0);return(0,r.jsx)(g.Provider,{value:{isOpen:a,toggle:()=>n(!a)},children:(0,r.jsx)("div",{className:"flex h-screen",children:t})})}function x(e){let{children:t,className:a}=e,{isOpen:s}=p();return(0,r.jsx)("div",{"data-sidebar":!0,className:c("bg-sidebar border-r border-sidebar-border transition-all duration-300",s?"w-64":"w-16",a),children:t})}function f(e){let{children:t,className:a}=e;return(0,r.jsx)("div",{className:c("p-4 border-b border-sidebar-border",a),children:t})}function v(e){let{children:t,className:a}=e;return(0,r.jsx)("div",{className:c("flex-1 overflow-y-auto p-4",a),children:t})}function b(e){let{className:t}=e,{toggle:a}=p();return(0,r.jsx)(h,{onClick:a,variant:"ghost",size:"sm",className:c("p-1 cursor-pointer",t),children:(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})}function j(e){let{children:t,className:a}=e;return(0,r.jsx)("main",{className:c("flex-1 overflow-auto",a),children:t})}var y=a(5604);let _=y.Ik({step_name:y.Yj(),step_count:y.ai().int().nonnegative(),step_failure:y.ai().int().nonnegative(),step_response_time:y.YO(y.ai().nonnegative()),step_bytes_in:y.ai().int().nonnegative(),step_bytes_out:y.ai().int().nonnegative()}),w=y.Ik({vu_id:y.ai().int().min(0),ts_exec_count:y.ai().int().nonnegative(),ts_exec_failure:y.ai().int().nonnegative(),ts_exec_time:y.YO(y.ai().nonnegative()),steps:y.YO(_)}),N=y.Ik({Target:y.ai().int().positive(),Duration:y.Yj()}),S=y.Ik({Metric:y.Yj(),Condition:y.Yj(),Severity:y.Yj(),Value:y.ai()}),k=y.Ik({Profile:y.Yj(),VUs:y.ai().int().positive(),Duration:y.Yj(),RPS:y.ai().int().positive(),Stages:y.YO(N).optional(),Thresholds:y.YO(S).optional()}),D=y.Ik({id:y.Yj().min(1),url:y.Yj().url(),title:y.Yj().min(1),created_at:y.Yj(),description:y.Yj(),load_options:k,end_at:y.Yj().optional()}),C=y.Ik({timestamp:y.ai().int().positive(),value:y.ai().nonnegative()}),A=y.Ik({timestamp:y.ai().int().positive(),avg_latency:y.ai().nonnegative()}),E=y.Ik({overall:y.YO(A),perStep:y.g1(y.Yj(),y.YO(C)),perVU:y.g1(y.Yj(),y.YO(C))});y.YO(D);let z=y.YO(w);y.Ik({dashboardData:y.g1(y.Yj(),z),chartHistories:y.g1(y.Yj(),E),dashboardStopTimes:y.g1(y.Yj(),y.Yj()),dashboardCloseTimes:y.g1(y.Yj(),y.Yj()).optional(),dashboardOpenedStatus:y.g1(y.Yj(),y.zM()).optional()});var I=a(3904),V=a(574),M=a(3786),P=a(4416);function O(e){let{selectedDashboard:t,onSelectDashboard:a,onDashboardDeleted:n}=e,{isOpen:l}=p(),[o,i]=(0,s.useState)([]),[d,c]=(0,s.useState)(!1),[u,g]=(0,s.useState)(null),m=async()=>{c(!0),g(null);try{for(let e=0;e<3;e++){let t=await fetch("http://localhost:2345/dashboards");if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();i(e=>{let t=[a,...e];return localStorage.setItem("klt-dashboards",JSON.stringify(t)),t}),e<2&&await new Promise(e=>setTimeout(e,300))}}catch(e){console.error("Failed to fetch dashboards:",e)}finally{c(!1)}};return(0,s.useEffect)(()=>{let e=localStorage.getItem("klt-dashboards");if(e)try{let t=JSON.parse(e);i(t)}catch(e){console.error("Failed to parse saved dashboards:",e)}m()},[]),(0,r.jsxs)(x,{children:[(0,r.jsx)(f,{children:(0,r.jsx)("div",{className:"flex items-center gap-2 w-full",children:(0,r.jsxs)(h,{onClick:m,disabled:d,variant:"ghost",size:"sm",className:"p-2 text-orange-900 rounded-md hover:bg-orange-100 h-full w-full justify-start cursor-pointer",children:[(0,r.jsx)(I.A,{className:"h-4 w-4 ".concat(d?"animate-spin":"")}),l&&(0,r.jsx)("h2",{className:"font-semibold text-lg ml-2",children:"KLT Dashboards"})]})})}),(0,r.jsx)(v,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[u&&l&&(0,r.jsx)("div",{className:"text-xs text-red-500 mt-1",children:u}),d&&(0,r.jsx)("div",{className:"text-sm text-gray-400 ".concat(!l&&"sr-only"),children:"Loading..."}),!d&&0===o.length&&!u&&(0,r.jsx)("div",{className:"text-sm text-gray-500 ".concat(!l&&"sr-only"),children:"No dashboards found"}),o.map(e=>(0,r.jsxs)("div",{className:"\n                w-full flex text-orange-900 items-center gap-2 p-2 rounded-md transition-colors group\n                ".concat((null==t?void 0:t.id)===e.id?"bg-orange-100 text-orange-900":"hover:bg-orange-100","\n              "),children:[(0,r.jsxs)("button",{onClick:()=>(e=>{let t=new URL(window.location.href);t.searchParams.set("dashboard",e.id),window.open(t.toString(),"_blank")})(e),className:"flex items-center gap-2 flex-1 min-w-0 text-left",title:"Open ".concat(e.title," in new tab"),children:[(0,r.jsx)(V.A,{className:"h-4 w-4 flex-shrink-0"}),l&&(0,r.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,r.jsx)("div",{className:"text-sm font-medium truncate",children:e.title}),(0,r.jsx)("div",{className:"text-xs text-orange-500 truncate",children:e.id})]}),l&&(0,r.jsx)(M.A,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity text-gray-400"})]}),l&&(0,r.jsx)(h,{onClick:t=>{t.stopPropagation();var a=e.id;i(e=>{let t=e.filter(e=>e.id!==a);return localStorage.setItem("klt-dashboards",JSON.stringify(t)),t});try{let e="dashboard-storage-dashboard-".concat(a);localStorage.removeItem(e),console.log("Cleaned up data for dashboard: ".concat(a))}catch(e){console.error("Failed to clean up dashboard data:",e)}null==n||n(a)},variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 h-6 w-6 p-0 hover:bg-red-100 hover:text-red-600 transition-opacity",title:"Delete ".concat(e.title),children:(0,r.jsx)(P.A,{className:"h-3 w-3"})})]},e.id))]})})]})}let U=(0,s.createContext)(void 0);function T(e){let{children:t}=e,[a,n]=(0,s.useState)(null);return(0,r.jsx)(U.Provider,{value:{selectedDashboard:a,setSelectedDashboard:n},children:t})}function R(){let e=(0,s.useContext)(U);if(void 0===e)throw Error("useDashboard must be used within a DashboardProvider");return e}function Y(e){let{lttoken:t,currentVUCount:a=0,stopped:n=!1,stopTime:l}=e,o=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[a,r]=(0,s.useState)("0s");return(0,s.useEffect)(()=>{if(!e||t)return;let a=()=>{let t=new Date(e).getTime(),a=Math.max(0,Math.floor((Date.now()-t)/1e3)),s=Math.floor(a/3600),n=Math.floor(a%3600/60),l=a%60;s>0?r("".concat(s,"h ").concat(n,"m ").concat(l,"s")):n>0?r("".concat(n,"m ").concat(l,"s")):r("".concat(l,"s"))};a();let s=setInterval(a,1e3);return()=>clearInterval(s)},[e,t]),a}(null==t?void 0:t.created_at,n);if(!t)return(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:(0,r.jsx)(F,{children:(0,r.jsxs)(K,{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-400",children:"--"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Select a dashboard"})]})})});let i=[{label:"Profile",value:t.load_options.Profile,color:"text-gray-600"},{label:"Active VUs",value:"".concat(a," / ").concat(t.load_options.VUs),color:"text-gray-600"},{label:"Target Duration",value:t.load_options.Duration,color:"text-gray-600"},{label:n?"Final Runtime":"Elapsed Time",value:n?l||"Stopped":o,color:n?"text-red-600":"text-blue-600"},{label:"Target RPS",value:t.load_options.RPS.toLocaleString(),color:"text-gray-600"},{label:"Status",value:n?"Completed":"Running",color:n?"text-red-600":"text-green-600"}];return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-orange-900",children:t.title}),(0,r.jsx)("p",{className:"text-orange-700 text-sm mt-1",children:t.description}),(0,r.jsxs)("p",{className:"text-orange-600 text-xs mt-2",children:["ID: ",t.id]})]}),(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-medium ".concat(n?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:n?"Completed":"Running"})]})}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:i.map(e=>(0,r.jsx)(F,{children:(0,r.jsxs)(K,{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold ".concat(e.color),children:e.value}),(0,r.jsx)("div",{className:"text-sm text-orange-600",children:e.label})]})},e.label))})]})}function F(e){let{children:t,className:a=""}=e;return(0,r.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg shadow-sm ".concat(a),children:t})}function K(e){let{children:t,className:a=""}=e;return(0,r.jsx)("div",{className:"p-4 ".concat(a),children:t})}var L=a(6268),G=a(1032);function J(e){let{data:t,columns:a,enableRowSelection:r=!0,defaultPageIndex:n,defaultPageSize:l,getRowId:o}=e,[i,d]=s.useState({}),[c,u]=s.useState({}),[h,g]=s.useState([]),[p,m]=s.useState([]),[x,f]=s.useState({pageIndex:null!=n?n:0,pageSize:null!=l?l:10});return(0,L.N4)({data:t,columns:a,state:{sorting:p,columnVisibility:c,rowSelection:i,columnFilters:h,pagination:x},enableRowSelection:r,getRowId:null!=o?o:e=>e.id.toString(),onRowSelectionChange:d,onSortingChange:m,onColumnFiltersChange:g,onColumnVisibilityChange:u,onPaginationChange:f,getCoreRowModel:(0,G.HT)(),getFilteredRowModel:(0,G.hM)(),getPaginationRowModel:(0,G.kW)(),getSortedRowModel:(0,G.h5)(),getFacetedRowModel:(0,G.kQ)(),getFacetedUniqueValues:(0,G.oS)()})}var B=a(17);function H(e){let{className:t,...a}=e;return(0,r.jsx)(B.bL,{"data-slot":"tabs",className:c("flex flex-col gap-2",t),...a})}function W(e){let{className:t,...a}=e;return(0,r.jsx)(B.B8,{"data-slot":"tabs-list",className:c("bg-orange-200/60 text-orange-700 inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function q(e){let{className:t,...a}=e;return(0,r.jsx)(B.l9,{"data-slot":"tabs-trigger",className:c("data-[state=active]:bg-orange-50 data-[state=active]:text-orange-900 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring data-[state=active]:border-orange-300 data-[state=active]:bg-orange-100 text-orange-800 hover:bg-orange-100/50 hover:text-orange-900 inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}var Q=a(5143),X=a(1206),Z=a(402);function $(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:c("w-full caption-bottom text-sm",t),...a})})}function ee(e){let{className:t,...a}=e;return(0,r.jsx)("thead",{"data-slot":"table-header",className:c("[&_tr]:border-b",t),...a})}function et(e){let{className:t,...a}=e;return(0,r.jsx)("tbody",{"data-slot":"table-body",className:c("[&_tr:last-child]:border-0",t),...a})}function ea(e){let{className:t,...a}=e;return(0,r.jsx)("tr",{"data-slot":"table-row",className:c("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function er(e){let{className:t,...a}=e;return(0,r.jsx)("th",{"data-slot":"table-head",className:c("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function es(e){let{className:t,...a}=e;return(0,r.jsx)("td",{"data-slot":"table-cell",className:c("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}var en=a(8266);function el(e){let{row:t}=e,{transform:a,transition:s,setNodeRef:n,isDragging:l}=(0,Z.gl)({id:t.original.id});return(0,r.jsx)(ea,{"data-state":t.getIsSelected()&&"selected","data-dragging":l,ref:n,className:"relative z-0 data-[dragging=true]:z-10 data-[dragging=true]:opacity-80",style:{transform:en.Ks.Transform.toString(a),transition:s},children:t.getVisibleCells().map(e=>(0,r.jsx)(es,{children:(0,L.Kv)(e.column.columnDef.cell,e.getContext())},e.id))})}function eo(e){let{table:t,columns:a,dndEnabled:n=!1,onReorder:l}=e,o=t.getRowModel().rows.map(e=>Number(e.id)),i=s.useId(),d=(0,Q.FR)((0,Q.MS)(Q.cA,{}),(0,Q.MS)(Q.IG,{}),(0,Q.MS)(Q.uN,{})),c=(0,r.jsxs)($,{children:[(0,r.jsx)(ee,{className:"bg-orange-100 sticky top-0 z-10",children:t.getHeaderGroups().map(e=>(0,r.jsx)(ea,{children:e.headers.map(e=>(0,r.jsx)(er,{colSpan:e.colSpan,children:e.isPlaceholder?null:(0,L.Kv)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,r.jsx)(et,{className:"**:data-[slot=table-cell]:first:w-8",children:function(e){let{table:t,columns:a,dndEnabled:s,dataIds:n}=e;return t.getRowModel().rows.length?s?(0,r.jsx)(Z.gB,{items:n,strategy:Z._G,children:t.getRowModel().rows.map(e=>(0,r.jsx)(el,{row:e},e.id))}):t.getRowModel().rows.map(e=>(0,r.jsx)(ea,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,r.jsx)(es,{children:(0,L.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,r.jsx)(ea,{children:(0,r.jsx)(es,{colSpan:a.length,className:"h-24 text-center",children:"No results."})})}({table:t,columns:a,dndEnabled:n,dataIds:o})})]});return n?(0,r.jsx)(Q.Mp,{collisionDetection:Q.fp,modifiers:[X.FN],onDragEnd:function(e){let{active:a,over:r}=e;if(a&&r&&a.id!==r.id&&l){let e=o.indexOf(a.id),s=o.indexOf(r.id);l((0,Z.be)(t.options.data,e,s))}},sensors:d,id:i,children:c}):c}var ei=a(2278),ed=a(2355),ec=a(3052),eu=a(2767),eh=a(968);function eg(e){let{className:t,...a}=e;return(0,r.jsx)(eh.b,{"data-slot":"label",className:c("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}var ep=a(1918),em=a(6474),ex=a(5196),ef=a(7863);function ev(e){let{...t}=e;return(0,r.jsx)(ep.bL,{"data-slot":"select",...t})}function eb(e){let{...t}=e;return(0,r.jsx)(ep.WT,{"data-slot":"select-value",...t})}function ej(e){let{className:t,size:a="default",children:s,...n}=e;return(0,r.jsxs)(ep.l9,{"data-slot":"select-trigger","data-size":a,className:c("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n,children:[s,(0,r.jsx)(ep.In,{asChild:!0,children:(0,r.jsx)(em.A,{className:"size-4 opacity-50"})})]})}function ey(e){let{className:t,children:a,position:s="popper",...n}=e;return(0,r.jsx)(ep.ZL,{children:(0,r.jsxs)(ep.UC,{"data-slot":"select-content",className:c("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...n,children:[(0,r.jsx)(ew,{}),(0,r.jsx)(ep.LM,{className:c("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,r.jsx)(eN,{})]})})}function e_(e){let{className:t,children:a,...s}=e;return(0,r.jsxs)(ep.q7,{"data-slot":"select-item",className:c("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...s,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(ep.VF,{children:(0,r.jsx)(ex.A,{className:"size-4"})})}),(0,r.jsx)(ep.p4,{children:a})]})}function ew(e){let{className:t,...a}=e;return(0,r.jsx)(ep.PP,{"data-slot":"select-scroll-up-button",className:c("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(ef.A,{className:"size-4"})})}function eN(e){let{className:t,...a}=e;return(0,r.jsx)(ep.wn,{"data-slot":"select-scroll-down-button",className:c("flex cursor-default items-center justify-center py-1",t),...a,children:(0,r.jsx)(em.A,{className:"size-4"})})}function eS(e){let{table:t}=e;return(0,r.jsx)("div",{className:"flex items-center justify-between px-4",children:(0,r.jsxs)("div",{className:"flex w-full items-center gap-8 lg:w-fit",children:[(0,r.jsxs)("div",{className:"hidden items-center gap-2 lg:flex",children:[(0,r.jsx)(eg,{htmlFor:"rows-per-page",className:"text-sm font-medium",children:"Rows per page"}),(0,r.jsxs)(ev,{value:"".concat(t.getState().pagination.pageSize),onValueChange:e=>t.setPageSize(Number(e)),children:[(0,r.jsx)(ej,{className:"h-8 w-[70px] bg-orange-50 border border-orange-200 hover:bg-orange-100",id:"rows-per-page",children:(0,r.jsx)(eb,{placeholder:t.getState().pagination.pageSize})}),(0,r.jsx)(ey,{side:"top",className:"bg-orange-50 border border-orange-200 shadow-lg",children:[10,20,30,40,50].map(e=>(0,r.jsx)(e_,{value:"".concat(e),className:"hover:bg-orange-100",children:e},e))})]})]}),(0,r.jsxs)("div",{className:"flex w-fit items-center justify-center text-sm font-medium",children:["Page ",t.getState().pagination.pageIndex+1," of ",t.getPageCount()]}),(0,r.jsxs)("div",{className:"ml-auto flex items-center gap-2 lg:ml-0",children:[(0,r.jsxs)(h,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>t.setPageIndex(0),disabled:!t.getCanPreviousPage(),children:[(0,r.jsx)("span",{className:"sr-only",children:"Go to first page"}),(0,r.jsx)(ei.A,{})]}),(0,r.jsxs)(h,{variant:"outline",className:"size-8",size:"icon",onClick:()=>t.previousPage(),disabled:!t.getCanPreviousPage(),children:[(0,r.jsx)("span",{className:"sr-only",children:"Go to previous page"}),(0,r.jsx)(ed.A,{})]}),(0,r.jsxs)(h,{variant:"outline",className:"size-8",size:"icon",onClick:()=>t.nextPage(),disabled:!t.getCanNextPage(),children:[(0,r.jsx)("span",{className:"sr-only",children:"Go to next page"}),(0,r.jsx)(ec.A,{})]}),(0,r.jsxs)(h,{variant:"outline",className:"hidden size-8 lg:flex",size:"icon",onClick:()=>t.setPageIndex(t.getPageCount()-1),disabled:!t.getCanNextPage(),children:[(0,r.jsx)("span",{className:"sr-only",children:"Go to last page"}),(0,r.jsx)(eu.A,{})]})]})]})})}function ek(e){if(!Array.isArray(e)||0===e.length)return"-";let t=[...e].sort((e,t)=>e-t),a=Math.floor(.95*(t.length-1));return(t[a]/1e6).toFixed(2)}function eD(e){if(!Array.isArray(e)||0===e.length)return"-";let t=[...e].sort((e,t)=>e-t),a=Math.floor(.9*(t.length-1));return(t[a]/1e6).toFixed(2)}function eC(e){if(!Array.isArray(e)||0===e.length)return"-";let t=[...e].sort((e,t)=>e-t),a=Math.floor(.99*(t.length-1));return(t[a]/1e6).toFixed(2)}function eA(e){return"number"!=typeof e||isNaN(e)?"-":(e/1048576).toFixed(2)}function eE(e){let{data:t,isCompleted:a=!1}=e,[n,l]=s.useState(()=>null!=t?t:[]),[o,i]=s.useState("virtual-users"),[d,c]=s.useState(()=>null!=t?t:[]),[u,h]=s.useState(()=>(null!=t?t:[]).flatMap(e=>Array.isArray(e.steps)?e.steps.map(t=>({...t,vu_id:e.vu_id})):[]));s.useEffect(()=>{console.log("DataTable updating with data:",(null==t?void 0:t.length)||0,"records"),l(null!=t?t:[]),c(null!=t?t:[]),h((null!=t?t:[]).flatMap(e=>Array.isArray(e.steps)?e.steps.map(t=>({...t,vu_id:e.vu_id})):[]))},[t]),s.useEffect(()=>{"virtual-users"===o?c(n):"steps"===o&&h(n.flatMap(e=>Array.isArray(e.steps)?e.steps.map(t=>({...t,vu_id:e.vu_id})):[]))},[o,n]);let g=s.useMemo(()=>{let e={},t={};return n.forEach(a=>{Array.isArray(a.steps)&&a.steps.forEach(a=>{let r=a.step_name;if(r&&(e[r]||(e[r]={step_name:r,step_count:0,step_failure:0,step_response_time:[],step_bytes_in:0,step_bytes_out:0,step_response_time_averages:[]},t[r]=[]),e[r].step_count+="number"==typeof a.step_count?a.step_count:0,e[r].step_failure+="number"==typeof a.step_failure?a.step_failure:0,e[r].step_bytes_in+="number"==typeof a.step_bytes_in?a.step_bytes_in:0,e[r].step_bytes_out+="number"==typeof a.step_bytes_out?a.step_bytes_out:0,Array.isArray(a.step_response_time)&&a.step_response_time.length>0)){e[r].step_response_time.push(...a.step_response_time);let s=a.step_response_time.reduce((e,t)=>e+t,0)/a.step_response_time.length;t[r].push(s)}})}),Object.keys(e).forEach(a=>{e[a].step_response_time_averages=t[a]}),Object.values(e)},[n]);s.useEffect(()=>{"virtual-users"===o?c(n):"steps"===o&&h(g)},[o,g]);let p=[{accessorKey:"vu_id",header:"ID"},{accessorKey:"ts_exec_count",header:"TSExecCount"},{accessorKey:"ts_exec_failure",header:"TSExecFailure"},{accessorKey:"steps",header:"StepExecCount",cell:e=>{let{row:t}=e;return Array.isArray(t.original.steps)?t.original.steps.reduce((e,t)=>e+("number"==typeof t.step_count?t.step_count:0),0):"-"}},{accessorKey:"ts_exec_time",header:"AvgTSExecTime(ms)",cell:e=>{let{row:t}=e;var a=t.original.ts_exec_time;return Array.isArray(a)&&0!==a.length?(a.reduce((e,t)=>e+t,0)/a.length/1e6).toFixed(2):"-"}},{accessorKey:"ts_exec_time_p90",header:"P90TSExecTime(ms)",cell:e=>{let{row:t}=e;return eD(t.original.ts_exec_time)}},{accessorKey:"ts_exec_time_p95",header:"P95TSExecTime(ms)",cell:e=>{let{row:t}=e;return ek(t.original.ts_exec_time)}},{accessorKey:"ts_exec_time_p99",header:"P99TSExecTime(ms)",cell:e=>{let{row:t}=e;return eC(t.original.ts_exec_time)}}],m=[{accessorKey:"step_name",header:"Step Name"},{accessorKey:"step_count",header:"Count(All VUs)",cell:e=>{var t;let{row:a}=e;return null!=(t=a.original.step_count)?t:"-"}},{accessorKey:"step_failure",header:"Failure(All VUs)",cell:e=>{var t;let{row:a}=e;return null!=(t=a.original.step_failure)?t:"-"}},{accessorKey:"step_bytes_in",header:"BytesIn(MB)",cell:e=>{let{row:t}=e;return eA(t.original.step_bytes_in)}},{accessorKey:"step_bytes_out",header:"BytesOut (MB)",cell:e=>{let{row:t}=e;return eA(t.original.step_bytes_out)}},{accessorKey:"step_response_time",header:"AvgResponseTime(ms)",cell:e=>{let{row:t}=e,a=t.original.step_response_time_averages;return Array.isArray(a)&&0!==a.length?(a.reduce((e,t)=>e+t,0)/a.length/1e6).toFixed(2):"-"}},{accessorKey:"p90",header:"P90(ms)",cell:e=>{let{row:t}=e;return eD(t.original.step_response_time)}},{accessorKey:"p95",header:"P95(ms)",cell:e=>{let{row:t}=e;return ek(t.original.step_response_time)}},{accessorKey:"p99",header:"P99(ms)",cell:e=>{let{row:t}=e;return eC(t.original.step_response_time)}}],x=J({data:d,columns:p,getRowId:(e,t)=>null!=e.vu_id?e.vu_id.toString():"row-".concat(t)}),f=J({data:u,columns:m,getRowId:(e,t)=>null!=e.vu_id&&null!=e.step_name?"".concat(e.vu_id,"-").concat(e.step_name):e.step_name?e.step_name+"-"+t:"row-"+t});return t&&0!==t.length?(0,r.jsxs)("div",{className:"w-full bg-orange-50 border border-orange-200 rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"p-4 border-b border-orange-200 bg-orange-100",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-orange-900",children:"Load Test Data"}),(0,r.jsx)("p",{className:"text-sm text-orange-700",children:"virtual-users"===o?"".concat(d.length," Virtual Users"):"".concat(g.length," Unique Steps")})]}),(0,r.jsx)(H,{value:o,onValueChange:e=>i(e),className:"w-fit",children:(0,r.jsxs)(W,{children:[(0,r.jsx)(q,{value:"virtual-users",children:"Virtual Users"}),(0,r.jsx)(q,{value:"steps",children:"Steps"})]})})]})}),(0,r.jsxs)("div",{className:"relative flex flex-col",children:[(0,r.jsx)("div",{className:"overflow-hidden px-2",children:"virtual-users"===o?(0,r.jsx)(eo,{dndEnabled:!0,table:x,columns:p,onReorder:c}):(0,r.jsx)(eo,{dndEnabled:!0,table:f,columns:m,onReorder:h})}),(0,r.jsx)("div",{className:"p-4 border-t border-orange-200 bg-orange-100",children:"virtual-users"===o?(0,r.jsx)(eS,{table:x}):(0,r.jsx)(eS,{table:f})})]})]}):(0,r.jsx)("div",{className:"w-full bg-orange-50 border border-orange-200 rounded-lg p-8 text-center text-orange-600",children:"No VU data available"})}var ez=a(8247),eI=a(3406),eV=a(7156);function eM(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:c("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function eP(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:c("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function eO(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:c("leading-none font-semibold",t),...a})}function eU(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:c("text-muted-foreground text-sm",t),...a})}function eT(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:c("px-6",t),...a})}var eR=a(3540),eY=a(8124),eF=a(2319);let eK={light:"",dark:".dark"},eL=s.createContext(null);function eG(e){let{id:t,className:a,children:n,config:l,...o}=e,i=s.useId(),d="chart-".concat(t||i.replace(/:/g,""));return(0,r.jsx)(eL.Provider,{value:{config:l},children:(0,r.jsxs)("div",{"data-slot":"chart","data-chart":d,className:c("[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",a),...o,children:[(0,r.jsx)(eJ,{id:d,config:l}),(0,r.jsx)(eR.u,{children:n})]})})}let eJ=e=>{let{id:t,config:a}=e,s=Object.entries(a).filter(e=>{let[,t]=e;return t.theme||t.color});return s.length?(0,r.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(eK).map(e=>{let[a,r]=e;return"\n".concat(r," [data-chart=").concat(t,"] {\n").concat(s.map(e=>{var t;let[r,s]=e,n=(null==(t=s.theme)?void 0:t[a])||s.color;return n?"  --color-".concat(r,": ").concat(n,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null},eB=eY.m;function eH(e){let{active:t,payload:a,className:n,indicator:l="dot",hideLabel:o=!1,hideIndicator:i=!1,label:d,labelFormatter:u,labelClassName:h,formatter:g,color:p,nameKey:m,labelKey:x}=e,{config:f}=function(){let e=s.useContext(eL);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}(),v=s.useMemo(()=>{var e;if(o||!(null==a?void 0:a.length))return null;let[t]=a,s="".concat(x||(null==t?void 0:t.dataKey)||(null==t?void 0:t.name)||"value"),n=eW(f,t,s),l=x||"string"!=typeof d?null==n?void 0:n.label:(null==(e=f[d])?void 0:e.label)||d;return u?(0,r.jsx)("div",{className:c("font-medium",h),children:u(l,a)}):l?(0,r.jsx)("div",{className:c("font-medium",h),children:l}):null},[d,u,a,o,h,f,x]);if(!t||!(null==a?void 0:a.length))return null;let b=1===a.length&&"dot"!==l;return(0,r.jsxs)("div",{className:c("border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",n),children:[b?null:v,(0,r.jsx)("div",{className:"grid gap-1.5",children:a.map((e,t)=>{let a="".concat(m||e.name||e.dataKey||"value"),s=eW(f,e,a),n=p||(null==s?void 0:s.color)||e.color||e.stroke||e.fill||"hsl(var(--chart-".concat(t%5+1,"))");return(0,r.jsx)("div",{className:c("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5","dot"===l&&"items-center"),children:g&&(null==e?void 0:e.value)!==void 0&&e.name?g(e.value,e.name,e,t,e.payload):(0,r.jsxs)(r.Fragment,{children:[(null==s?void 0:s.icon)?(0,r.jsx)(s.icon,{}):!i&&(0,r.jsx)("div",{className:c("shrink-0 rounded-[2px]",{"h-2.5 w-2.5":"dot"===l,"w-1":"line"===l,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===l,"my-0.5":b&&"dashed"===l}),style:{backgroundColor:"dashed"!==l?n:"transparent",borderColor:n,..."dashed"===l&&{borderStyle:"dashed"}}}),(0,r.jsxs)("div",{className:c("flex flex-1 justify-between leading-none",b?"items-end":"items-center"),children:[(0,r.jsxs)("div",{className:"grid gap-1.5",children:[b?v:null,(0,r.jsx)("span",{className:"text-muted-foreground",children:(null==s?void 0:s.label)||e.name})]}),e.value&&(0,r.jsx)("span",{className:"text-foreground font-mono font-medium tabular-nums",children:"number"==typeof e.value?e.value.toLocaleString():e.value})]})]})},e.dataKey||t)})})]})}function eW(e,t,a){if("object"!=typeof t||null===t)return;let r="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,s=a;return a in t&&"string"==typeof t[a]?s=t[a]:r&&a in r&&"string"==typeof r[a]&&(s=r[a]),s in e?e[s]:e[a]}eF.s;var eq=a(2493);let eQ=(0,o.F)("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),eX=s.createContext({size:"default",variant:"default"});function eZ(e){let{className:t,variant:a,size:s,children:n,...l}=e;return(0,r.jsx)(eq.bL,{"data-slot":"toggle-group","data-variant":a,"data-size":s,className:c("group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs",t),...l,children:(0,r.jsx)(eX.Provider,{value:{variant:a,size:s},children:n})})}function e$(e){let{className:t,children:a,variant:n,size:l,...o}=e,i=s.useContext(eX);return(0,r.jsx)(eq.q7,{"data-slot":"toggle-group-item","data-variant":i.variant||n,"data-size":i.size||l,className:c(eQ({variant:i.variant||n,size:i.size||l}),"min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l",t),...o,children:a})}function e0(e){return Array.isArray(e)&&0!==e.length?e.reduce((e,t)=>e+t,0)/e.length:0}function e1(e){let{vuData:t=[],chartHistory:a,setChartHistory:n,isCompleted:l=!1}=e,[o,i]=s.useState("overall"),[d,c]=s.useState(!1),u=s.useRef("");s.useEffect(()=>{if(!Array.isArray(t)||0===t.length)return;if(l&&a.overall.length>0)return void console.log("Dashboard is completed and chart history exists, skipping chart updates");let e=JSON.stringify(t.map(e=>{var t;return{id:e.vu_id,stepCount:(null==(t=e.steps)?void 0:t.length)||0,timestamp:Date.now()}}));if(e===u.current)return;u.current=e;let r=Date.now(),s=[];t.forEach(e=>{var t;null==(t=e.steps)||t.forEach(e=>{Array.isArray(e.step_response_time)&&s.push(...e.step_response_time)})});let o=e0(s)/1e6,i=Array.from(new Set(t.flatMap(e=>{var t;return(null==(t=e.steps)?void 0:t.map(e=>e.step_name))||[]}))).filter(Boolean);n(e=>{let a={...e.perStep};i.forEach(e=>{let s=[];t.forEach(t=>{var a;null==(a=t.steps)||a.forEach(t=>{t.step_name===e&&Array.isArray(t.step_response_time)&&s.push(...t.step_response_time)})});let n=e0(s)/1e6;a[e]||(a[e]=[]),a[e]=[...a[e],{timestamp:r,value:n}]});let s=Array.from(new Set(t.map(e=>e.vu_id.toString()))),n={...e.perVU};return s.forEach(e=>{let a=[];t.forEach(t=>{if(t.vu_id.toString()===e){var r;null==(r=t.steps)||r.forEach(e=>{Array.isArray(e.step_response_time)&&a.push(...e.step_response_time)})}});let s=e0(a)/1e6;n[e]||(n[e]=[]),n[e]=[...n[e],{timestamp:r,value:s}]}),{overall:[...e.overall,{timestamp:r,avg_latency:o}],perStep:a,perVU:n}})},[t,l]);let g=s.useMemo(()=>{if("overall"===o)return a.overall.map(e=>({timestamp:e.timestamp,avg_latency:e.avg_latency}));if("perStep"===o){let e=Object.keys(a.perStep);return Array.from(new Set(e.flatMap(e=>(a.perStep[e]||[]).map(e=>e.timestamp)))).sort((e,t)=>e-t).map(t=>{let r={timestamp:t};return e.forEach(e=>{let s=(a.perStep[e]||[]).find(e=>e.timestamp===t);s&&(r[e]=s.value)}),r})}if("perVU"===o){let e=Object.keys(a.perVU);return Array.from(new Set(e.flatMap(e=>(a.perVU[e]||[]).map(e=>e.timestamp)))).sort((e,t)=>e-t).map(t=>{let r={timestamp:t};return e.forEach(e=>{let s=(a.perVU[e]||[]).find(e=>e.timestamp===t);s&&(r[e]=s.value)}),r})}return[]},[a,o]),p=s.useMemo(()=>{if("overall"===o)return{avg_latency:{label:"Avg Latency (ms)",color:"var(--chart-1)"}};if("perStep"===o){let e=Object.keys(a.perStep),t=["var(--chart-1)","var(--chart-2)","var(--chart-3)","var(--chart-4)","var(--chart-5)"];return Object.fromEntries(e.map((e,a)=>[e,{label:e,color:t[a%t.length]}]))}if("perVU"===o){let e=Object.keys(a.perVU),t=["var(--chart-1)","var(--chart-2)","var(--chart-3)","var(--chart-4)","var(--chart-5)"];return Object.fromEntries(e.map((e,a)=>[e,{label:"VU ".concat(e),color:t[a%t.length]}]))}return{}},[o,a]),m=s.useMemo(()=>"perStep"===o?Object.entries(a.perStep).map(e=>{let[t,a]=e;return{key:t,label:t,data:a.map(e=>({timestamp:e.timestamp,value:e.value}))}}):"perVU"===o?Object.entries(a.perVU).map(e=>{let[t,a]=e;return{key:t,label:"VU ".concat(t),data:a.map(e=>({timestamp:e.timestamp,value:e.value}))}}):[],[o,a]),x=d?m:m.slice(0,4);return t&&0!==t.length?(0,r.jsxs)(eM,{className:"@container/card",children:[(0,r.jsx)(eP,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(eO,{children:"Average Latency"}),(0,r.jsxs)(eU,{children:[(0,r.jsxs)("span",{className:"hidden @[540px]/card:block",children:["Latency by"," ","overall"===o?"All Steps":"perStep"===o?"Step":"VU"]}),(0,r.jsx)("span",{className:"@[540px]/card:hidden",children:"Latency"})]})]}),(0,r.jsxs)(eZ,{type:"single",value:o,onValueChange:e=>e&&i(e),variant:"outline",className:"gap-2",children:[(0,r.jsx)(e$,{value:"overall",className:"text-xs transition-all ".concat("overall"===o?"bg-orange-100 text-orange-900 border-orange-300 shadow-sm":"hover:bg-oragne-50"),children:"Overall"}),(0,r.jsx)(e$,{value:"perStep",className:"text-xs transition-all ".concat("perStep"===o?"bg-orange-100 text-orange-900 border-orange-300 shadow-sm":"hover:bg-orange-50"),children:"Per Step"}),(0,r.jsx)(e$,{value:"perVU",className:"text-xs transition-all ".concat("perVU"===o?"bg-orange-100 text-orange-900 border-orange-300 shadow-sm":"hover:bg-orange-50"),children:"Per VU"})]})]})}),(0,r.jsx)(eT,{className:"px-2 pt-4 sm:px-6 sm:pt-6",children:(0,r.jsx)(eG,{config:p,className:"aspect-auto h-[250px] w-full",children:(0,r.jsxs)(ez.Q,{data:g,children:[(0,r.jsx)(eI.d,{vertical:!1}),(0,r.jsx)(eB,{cursor:!1,content:(0,r.jsx)(eH,{indicator:"line",hideLabel:!0})}),Object.keys(p).map(e=>(0,r.jsx)(eV.Gk,{dataKey:e,type:"natural",fill:p[e].color,fillOpacity:.3,stroke:p[e].color,strokeWidth:2,name:p[e].label||e},e))]})})}),("perStep"===o||"perVU"===o)&&m.length>0&&(0,r.jsxs)("div",{className:"px-4",children:[m.length>4&&(0,r.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Individual ","perStep"===o?"Step":"VU"," Charts",(0,r.jsxs)("span",{className:"text-gray-500 font-normal ml-1",children:["(",d?m.length:Math.min(4,m.length)," ","of ",m.length,")"]})]}),(0,r.jsx)(h,{variant:"outline",size:"sm",onClick:()=>c(!d),className:"text-xs cursor-pointer",children:d?"Show Less (4 of ".concat(m.length,")"):"Show All ".concat("perStep"===o?"Steps":"VUs"," (").concat(m.length,")")})]}),m.length<=4&&(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-700",children:["Individual ","perStep"===o?"Step":"VU"," Charts",(0,r.jsxs)("span",{className:"text-gray-500 font-normal ml-1",children:["(",m.length,")"]})]})}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:x.map((e,t)=>{let{key:a,label:s,data:n}=e,l=["var(--chart-1)","var(--chart-2)","var(--chart-3)","var(--chart-4)","var(--chart-5)"],o=l[t%l.length];return(0,r.jsxs)(eM,{className:"h-[180px] overflow-hidden",children:[(0,r.jsx)(eP,{children:(0,r.jsx)(eO,{className:"font-medium truncate leading-tight -m-2",title:s,children:s})}),(0,r.jsx)(eT,{className:"px-3",children:(0,r.jsx)("div",{className:"h-[130px] w-full",children:(0,r.jsx)(eG,{config:{value:{label:s,color:o}},className:"h-full w-full",children:(0,r.jsxs)(ez.Q,{data:n,margin:{top:20,right:2,left:2,bottom:20},children:[(0,r.jsx)(eB,{cursor:!1,content:(0,r.jsx)(eH,{indicator:"dot"})}),(0,r.jsx)(eV.Gk,{type:"natural",dataKey:"value",fill:o,fillOpacity:.4,stroke:o,strokeWidth:1.5,name:p[a].label||a})]})})})})]},a)})}),m.length>4&&(0,r.jsx)("div",{className:"mt-4 flex justify-center",children:(0,r.jsx)(h,{variant:"outline",size:"sm",onClick:()=>c(!d),className:"text-xs cursor-pointer",children:d?"Show Less (4 of ".concat(m.length,")"):"Show All ".concat("perStep"===o?"Steps":"VUs"," (").concat(m.length,")")})})]})]}):(0,r.jsxs)(eM,{className:"w-full",children:[(0,r.jsxs)(eP,{children:[(0,r.jsx)(eO,{children:"Average Latency"}),(0,r.jsx)(eU,{children:"No data available"})]}),(0,r.jsx)(eT,{className:"h-[250px] flex items-center justify-center text-gray-500",children:"No data is available"})]})}function e2(){let{selectedDashboard:e,setSelectedDashboard:t}=R(),[a,n]=(0,s.useState)({}),[l,o]=(0,s.useState)({}),[i,d]=(0,s.useState)({}),[c,u]=(0,s.useState)({}),[h,g]=(0,s.useState)({}),[p,x]=(0,s.useState)(!1),f=(null==e?void 0:e.id)||"",v=a[f]||[],y=l[f]||{overall:[],perStep:{},perVU:{}},_=(0,s.useRef)(a),N=(0,s.useRef)(l),S=(0,s.useRef)(i),k=(0,s.useRef)(c),D=(0,s.useRef)(h);(0,s.useEffect)(()=>{_.current=a},[a]),(0,s.useEffect)(()=>{N.current=l},[l]),(0,s.useEffect)(()=>{S.current=i},[i]),(0,s.useEffect)(()=>{k.current=c},[c]),(0,s.useEffect)(()=>{D.current=h},[h]);let C=(e,t)=>"".concat(e,"-dashboard-").concat(t),A=e=>{let t=Math.floor(e/3600),a=Math.floor(e%3600/60),r=e%60;return t>0?"".concat(t,"h ").concat(a,"m ").concat(r,"s"):a>0?"".concat(a,"m ").concat(r,"s"):"".concat(r,"s")};(0,s.useEffect)(()=>{if(!(null==e?void 0:e.id))return void x(!1);try{let t=C("dashboard-storage",e.id),a=localStorage.getItem(t);if(a){let t=JSON.parse(a);n(t.dashboardData||{}),o(t.chartHistories||{}),d(t.dashboardStopTimes||{}),u(t.dashboardCloseTimes||{}),g(t.dashboardOpenedStatus||{}),console.log("✅ Loaded data for dashboard: ".concat(e.id," (").concat(Object.keys(t.dashboardData||{}).length," dashboards)"))}else console.log("ℹ️ No stored data found for dashboard: ".concat(e.id))}catch(e){console.error("Failed to load from localStorage:",e)}finally{x(!0)}},[null==e?void 0:e.id]),(0,s.useEffect)(()=>{if(!(null==e?void 0:e.id)||!p)return;let t=e.id;h[t]||(g(e=>({...e,[t]:!0})),console.log("Marked dashboard ".concat(t," as opened for the first time")),E(e.url).then(e=>{e||(d(e=>({...e,[t]:"0s"})),console.log("Dashboard ".concat(t,' first opened with server down - marked as "0s" complete time')))}))},[null==e?void 0:e.id,h,null==e?void 0:e.url,p]);let E=async e=>{try{return(await fetch(e,{cache:"no-store",signal:AbortSignal.timeout(3e3)})).ok}catch(t){return console.log("Server health check failed for ".concat(e,":"),t),!1}};(0,s.useEffect)(()=>{if(!(null==e?void 0:e.id)||!(null==e?void 0:e.created_at)||!(null==e?void 0:e.url)||!p)return;let t=e.id;if(!i[t]&&c[t]){let a=async()=>{if(await E(e.url))console.log("Dashboard ".concat(t," server is still live, continuing to update elapsed time"));else{let e=c[t];d(a=>({...a,[t]:e})),u(e=>{let a={...e};return delete a[t],a}),console.log("Dashboard ".concat(t," marked as completed (server offline) with saved close time: ").concat(e))}};a();let r=setInterval(a,1e4);return()=>clearInterval(r)}},[e,i,c,p]),(0,s.useEffect)(()=>{if(null==e?void 0:e.id)try{let t=C("dashboard-storage",e.id);localStorage.setItem(t,JSON.stringify({dashboardData:a,chartHistories:l,dashboardStopTimes:i,dashboardCloseTimes:c,dashboardOpenedStatus:h}))}catch(e){console.error("Failed to save to localStorage:",e)}},[a,l,i,c,h,null==e?void 0:e.id]),(0,s.useEffect)(()=>{if(!(null==e?void 0:e.id)||!(null==e?void 0:e.created_at))return;let t=()=>{if(!S.current[e.id])try{let t=new Date(e.created_at).getTime(),a=Date.now(),r=Math.max(0,Math.floor((a-t)/1e3)),s=A(r);u(t=>({...t,[e.id]:s}));let n=C("dashboard-storage",e.id),l=localStorage.getItem(n);if(l){let t=JSON.parse(l);t.dashboardCloseTimes={...t.dashboardCloseTimes,[e.id]:s},t.dashboardOpenedStatus={...t.dashboardOpenedStatus,[e.id]:!0},localStorage.setItem(n,JSON.stringify(t))}console.log("Saved close time for dashboard ".concat(e.id,": ").concat(s))}catch(e){console.error("Failed to save close time on unload:",e)}};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[null==e?void 0:e.id,null==e?void 0:e.created_at]);let z=async t=>{if(!t)return[];try{let a=await fetch(t,{cache:"no-store"});if(!a.ok)throw Error("Failed to fetch");let r=await a.json();if(console.log("Raw API data for ".concat(t," (Dashboard: ").concat(null==e?void 0:e.id,"):"),r),!Array.isArray(r))return console.warn("API returned non-array data:",typeof r),[];let s=[],n=[];r.forEach((t,a)=>{if(!t||"number"!=typeof t.vu_id)return void n.push({index:a,item:t,reason:"Missing or invalid vu_id"});let r=w.safeParse(t);r.success?(s.push(r.data),console.log("Valid VU ".concat(r.data.vu_id," at index ").concat(a," (Dashboard: ").concat(null==e?void 0:e.id,")"))):n.push({index:a,item:{vu_id:t.vu_id},reason:"Schema validation failed",errors:r.error.issues})}),console.log("Validation summary for ".concat(t," (Dashboard: ").concat(null==e?void 0:e.id,"):")),console.log("- Raw items: ".concat(r.length)),console.log("- Valid VUs: ".concat(s.length)),console.log("- Invalid items: ".concat(n.length)),n.length>0&&console.log("Invalid data details:",n);let l=s.map(e=>e.vu_id).sort((e,t)=>e-t);return console.log("Valid VU IDs: [".concat(l.join(", "),"] (Dashboard: ").concat(null==e?void 0:e.id,")")),s}catch(e){return console.error("Failed to fetch VU data:",e),[]}};(0,s.useEffect)(()=>{var t,r;let s;if(!(null==e?void 0:e.url))return;if(!p)return void console.log("Waiting for localStorage to load for dashboard: ".concat(f));let l=!!i[f],o=!!S.current[f],c=!!(null==(t=a[f])?void 0:t.length)&&(l||o);if(l||o||c)return void console.log("\uD83D\uDED1 Dashboard ".concat(f," is already completed. Not starting polling."),{isStopped:l,isStoppedInRef:o,hasCompletedData:c,dataLength:(null==(r=a[f])?void 0:r.length)||0});let u=!0,h=0,g=async()=>{var t;let a=S.current[f]||i[f];if(a){console.log("\uD83D\uDED1 Dashboard ".concat(f," was stopped during polling. Stop time: ").concat(a," (Dashboard: ").concat(null==e?void 0:e.id,")")),clearInterval(s);return}let r=(null==(t=_.current[f])?void 0:t.length)>0,l=!!a;if(r&&l){console.log("\uD83D\uDED1 Dashboard ".concat(f," has existing data and is completed. Preventing data overwrite. (Dashboard: ").concat(null==e?void 0:e.id,")")),clearInterval(s);return}try{let t=await z(e.url);if(S.current[f]||i[f]){console.log("\uD83D\uDED1 Dashboard ".concat(f," was completed while fetching. Discarding new data to preserve completed state.")),clearInterval(s);return}u&&(Array.isArray(t)&&t.length>0?(n(e=>({...e,[f]:t})),h=0,console.log("\uD83D\uDCCA Updated data for active dashboard ".concat(f," (").concat(t.length," records)"))):(h++,console.warn("No valid VU data received. Fail count: ".concat(h,"/").concat(3," (Dashboard: ").concat(null==e?void 0:e.id,")"))))}catch(t){console.error("Error fetching VU data (Dashboard: ".concat(null==e?void 0:e.id,"):"),t),h++}if(h>=3&&s){if(clearInterval(s),!S.current[f]){let t="0s";if(D.current[f]){if(null==e?void 0:e.created_at){let a=new Date(e.created_at).getTime();t=A(Math.max(0,Math.floor((Date.now()-a)/1e3)))}}else t="0s",console.log("Dashboard ".concat(f,' never opened before and server is down - using "0s" as complete time'));d(e=>({...e,[f]:t})),console.log("Dashboard ".concat(f," stopped after ").concat(3," failures. Final time: ").concat(t," (Dashboard: ").concat(null==e?void 0:e.id,")"))}console.warn("Stopped polling for dashboard ".concat(f," due to repeated fetch failures. (Dashboard: ").concat(null==e?void 0:e.id,")"))}};return console.log("Starting data polling for dashboard: ".concat(f," (Dashboard: ").concat(null==e?void 0:e.id,")")),g(),s=setInterval(g,1e3),()=>{u=!1,s&&(clearInterval(s),console.log("Stopped polling for dashboard: ".concat(f," (Dashboard: ").concat(null==e?void 0:e.id,")")))}},[e,f,i,p]);let I=v.length,V=!!i[f];return(0,r.jsxs)(m,{children:[(0,r.jsx)(O,{selectedDashboard:e,onSelectDashboard:t,onDashboardDeleted:a=>{n(e=>{let t={...e};return delete t[a],t}),o(e=>{let t={...e};return delete t[a],t}),d(e=>{let t={...e};return delete t[a],t}),u(e=>{let t={...e};return delete t[a],t}),g(e=>{let t={...e};return delete t[a],t}),(null==e?void 0:e.id)===a&&t(null),console.log("Removed dashboard ".concat(a," from component state (Dashboard: ").concat(null==e?void 0:e.id,")"))}}),(0,r.jsxs)(j,{children:[(0,r.jsxs)("header",{className:"flex h-12 items-center gap-2 border-b px-4",children:[(0,r.jsx)(b,{className:"text-orange-900"}),(0,r.jsx)("h1",{className:"text-lg font-semibold text-orange-900",children:e?e.title:"Select a Dashboard"}),e&&(0,r.jsxs)("span",{className:"text-xs text-orange-500 ml-auto",children:["Dashboard: ",e.id]})]}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"@container/main flex flex-col gap-4 md:gap-6",children:[(0,r.jsx)(Y,{lttoken:null!=e?e:void 0,stopped:V,stopTime:i[f],currentVUCount:I}),(0,r.jsx)(e1,{vuData:v,chartHistory:y,setChartHistory:e=>{o(t=>({...t,[f]:e(t[f]||{overall:[],perStep:{},perVU:{}})}))},isCompleted:V}),(0,r.jsx)(eE,{data:v,isCompleted:V})]})})]})]})}function e5(){let{selectedDashboard:e,setSelectedDashboard:t}=R(),a=(0,n.useSearchParams)();return(0,s.useEffect)(()=>{let r=null==a?void 0:a.get("dashboard");if(r&&!e){let e=localStorage.getItem("klt-dashboards");if(e)try{let a=JSON.parse(e).find(e=>e.id===r);a&&t(a)}catch(e){console.error("Failed to parse saved dashboards:",e)}}},[a,e,t]),(0,r.jsx)(e2,{})}function e4(){return(0,r.jsx)(T,{children:(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,r.jsx)("div",{className:"text-orange-900",children:"Loading dashboard..."})}),children:(0,r.jsx)(e5,{})})})}}},e=>{e.O(0,[24,441,964,358],()=>e(e.s=2769)),_N_E=e.O()}]);